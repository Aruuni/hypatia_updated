# Tracking: link interface traffic-control queueing discipline queue

This tracks the queue of point-to-point network devices' interface traffic-control
main queueing discipline (part of a 'link').

It encompasses the following files:

* **QdiscQueueTracker:** `model/core/qdisc-queue-tracker.cc/h`

  Queue discipline's internal queue tracker.
  
* **PtopLinkInterfaceTcQdiscQueueTracking:** `helper/core/ptop-link-interface-tc-qdisc-queue-tracking.cc/h`
  
  Helper to install the qdisc queue trackers on the interfaces in a topology.

You can use the application(s) separately, or make use of the helper 
which requires a topology (which is recommended).


## Getting started: using helper

1. Add the following to the `config_ns3.properties` in your run folder:

   ```
   enable_link_interface_tc_qdisc_queue_tracking=true
   link_interface_tc_qdisc_queue_tracking_enable_for_links=all
   ```

2. In your code, import the helper:

   ```c++
   #include "ns3/ptop-link-interface-tc-qdisc-queue-tracking.h"
   ```
   
3. Before the start of the simulation run, in your code add:

   ```c++
    // Install link interface traffic-control qdisc queue trackers
    PtopLinkInterfaceTcQdiscQueueTracking tcQdiscQueueTracking = PtopLinkInterfaceTcQdiscQueueTracking(basicSimulation, topology);
   ```

4. After the run, in your code add:

   ```c++
    // Write link interface traffic-control qdisc queue results
    tcQdiscQueueTracking.WriteResults();
   ```
   
5. After the run, you should have the link interface traffic-control qdisc queue 
   log files in the `logs_ns3` of your run folder.


## Getting started: directly using tracker

1. In your code, import the tracker:

   ```c++
   #include "ns3/qdisc-queue-tracker.h"
   ```
   
2. Before the start of the simulation run, in your code add:

   ```c++
   Ptr<QueueDisc> queueDisc = ... // Get the queueing discipline from somewhere
   Ptr<QdiscQueueTracker> tracker = CreateObject<QdiscQueueTracker>(queueDisc);
   // ... store the tracker to keep it alive and later retrieve its results
   ```

3. After the run, in your code add:

   ```c++
   const std::vector<std::tuple<int64_t, int64_t, int64_t>> log_entries_pkt = tracker->GetIntervalsNumPackets();
   for (size_t j = 0; j < log_entries_pkt.size(); j++) {
       int64_t interval_start_ns = std::get<0>(log_entries_pkt[j]);
       int64_t interval_end_ns = std::get<1>(log_entries_pkt[j]);
       int64_t interval_queue_num_packets = std::get<2>(log_entries_pkt[j]);
       // ... then do something with it, print it
   }
   ```


## Helper configuration

You MUST set the following key in `config_ns3.properties` for queue tracking to be enabled:

* `enable_link_interface_tc_qdisc_queue_tracking` : 
  - **Description:** true iff link interface traffic-control qdisc queue tracking should be enabled 
  - **Value type:** boolean: `true` or `false`

The following CAN be set:

* `link_interface_tc_qdisc_queue_tracking_enable_for_links`
  - **Description:** select which links qdisc queue tracking should be enabled
  - **Value types:**
    - `all` to enable on all links (default)
    - Set of links (directed edges) `set(a->b, ...)` if only on a particular subset of links

## Helper log files

There are two log files generated by the run in the `logs_ns3` folder within the run folder:

#### `link_interface_tc_qdisc_queue_pkt.csv`

- **Description:** CSV formatted queue size in packets. The format is as follows:
- **Distributed filename:** `system_[X]_link_interface_tc_qdisc_queue_pkt.csv`
- **Format:**
  ```
  [from node id],[to node id],[interval start (ns since epoch)],[interval end (ns since epoch)],[number of packets (integer)]
  ```

#### `link_interface_tc_qdisc_queue_byte.csv`

- **Description:** CSV formatted queue size in bytes. The format is as follows:
- **Distributed filename:** `system_[X]_link_interface_tc_qdisc_queue_byte.csv`
- **Format:**
  ```
  [from node id],[to node id],[interval start (ns since epoch)],[interval end (ns since epoch)],[number of bytes (integer)]
  ```
